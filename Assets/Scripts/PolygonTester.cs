using UnityEngine;
using System;
public class PolygonTester : MonoBehaviour
{
    public Material testMat;
    string ArrayFromServer = "186,32|184,34|183,34|181,36|180,36|176,40|175,40|173,42|172,42|170,44|169,44|166,47|165,47|164,48|163,48|16 1,50|160,50|158,52|157,52|156,53|155,53|154,54|153,54|151,56|150,56|149,57|148,57|147,58|146,58|145,59|144, 59|143,60|142,60|141,61|139,61|137,63|136,63|135,64|134,64|133,65|132,65|131,66|130,66|129,67|128,67|127,68 |125,68|124,69|122,69|121,70|120,70|119,71|117,71|116,72|115,72|114,73|112,73|111,74|109,74|108,75|106,75|1 05,76|102,76|101,77|98,77|97,78|96,78|95,79|92,79|91,80|87,80|86,81|79,81|78,82|73,82|73,83|78,83|79,84|75, 88|75,89|71,93|71,94|68,97|68,98|65,101|65,102|63,104|63,105|62,106|62,107|60,109|60,110|55,115|51,115|50,1 14|45,114|44,113|43,113|42,112|42,111|40,111|38,109|38,108|36,106|36,105|35,104|36,103|36,101|37,100|37,99| 38,98|38,97|40,95|40,94|41,93|41,92|43,90|43,89|44,88|44,87|45,86|45,85|46,84|46,83|47,82|47,81|49,79|49,78 |51,76|51,75|53,73|53,72|55,70|55,69|58,66|58,65|61,62|61,61|64,58|64,57|65,56|65,55|66,54|66,53|67,52|67,51|69,49|69,48|71,46|71,44|70,44|67,47|64,47|63,46|62,46|61,45|60,45|59,44|58,44|57,43|55,43|54,42|53,42|52,41|50,41|49,40|48,40|46,38|44,38|42,40|43,41|43,42|44,43|44,44|43,45|43,46|43,45|44,44|44,43|46,41|47,41|48,42|51,42|52,43|53,43|54,44|55,44|56,45|58,45|59,46|60,46|61,47|62,47|63,48|64,48|65,49|65,51|64,52|64,53|63,54|63,55|61,57|61,58|59,60|59,61|56,64|56,65|53,68|53,69|52,70|52,71|50,73|50,74|47,77|47,78|46,79|46,80|45,81|45,82|43,84|43,85|41,87|41,88|40,89|40,90|39,91|39,92|37,94|37,95|35,97|35,99|34,100|34,101|33,102|33,107|34,108|35,108|36,109|36,110|39,113|39,114|41,114|42,115|43,115|44,116|54,116|55,117|58,117|58,116|59,115|59,114|61,112|61,111|62,110|62,109|64,107|64,106|66,104|66,103|68,101|68,100|70,98|70,97|73,94|73,93|81,85|81,84|82,83|86,83|87,82|91,82|92,81|95,81|96,80|99,80|100,79|101,79|102,78|104,78|105,77|108,77|109,76|111,76|112,75|114,75|115,74|117,74|118,73|119,73|120,72|121,72|122,71|124,71|125,70|127,70|128,69|129,69|130,68|132,68|133,67|134,67|135,66|136,66|137,65|138,65|140,63|141,63|142,62|144,62|146,60|147,60|148,59|149,59|150,58|151,58|152,57|153,57|155,55|157,55|159,53|160,53|161,52|162,52|163,51|164,51|167,48|168,48|171,45|172,45|174,43|175,43|178,40|179,40|180,39|181,39|184,36|185,36|186,35|187,35|192,40|193,40|198,45|198,46|197,47|196,47|195,48|194,48|192,50|191,50|189,52|187,52|185,54|184,54|182,56|181,56|180,57|179,57|178,58|177,58|176,59|175,59|174,60|172,60|171,61|170,61|169,62|168,62|167,63|166,63|165,64|164,64|163,65|162,65|161,66|160,66|159,67|158,67|157,68|156,68|155,69|153,69|152,70|151,70|150,71|148,71|147,72|146,72|145,73|143,73|142,74|141,74|140,75|139,75|138,76|137,76|135,78|134,78|133,79|132,79|131,80|130,80|128,82|127,82|126,83|125,83|123,85|122,85|120,87|119,87|117,89|116,89|112,93|111,93|106,98|105,98|96,107|95,106|94,106|94,107|93,108|93,110|94,111|94,112|95,113|95,114|97,116|97,117|98,118|98,119|99,120|99,121|101,123|101,124|102,125|102,126|104,128|104,129|106,131|106,132|107,133|107,134|109,136|109,137|112,140|112,141|115,144|115,145|120,150|120,151|121,152|122,152|126,156|127,156|130,159|131,159|133,161|136,161|137,160|138,160|139,159|141,159|142,158|144,158|144,157|145,156|145,155|148,152|148,151|149,150|149,149|157,141|158,141|163,136|164,136|168,132|169,132|173,128|174,128|187,115|188,115|189,114|189,113|191,111|192,111|200,103|201,103|206,98|207,98|210,95|211,95|213,93|214,93|217,90|218,90|221,87|222,87|224,85|225,85|227,83|228,83|234,77|235,77|237,75|238,75|243,70|244,70|247,67|248,67|253,62|254,62|256,60|256,59|257,58|257,56|256,56|251,61|250,61|244,67|243,67|240,70|239,70|235,74|234,74|230,78|229,78|226,81|225,81|221,85|220,85|218,87|217,87|214,90|213,90|210,93|209,93|207,95|206,95|203,98|202,98|197,103|196,103|183,116|182,116|182,117|178,121|177,121|177,122|176,123|175,123|175,124|174,125|173,125|169,129|168,129|164,133|163,133|158,138|157,138|153,142|152,142|152,143|151,144|150,144|150,145|147,148|147,149|146,150|146,151|144,153|144,154|143,155|143,156|142,157|141,157|140,158|138,158|137,159|133,159|130,156|129,156|118,145|118,144|112,138|112,137|110,135|110,134|108,132|108,131|107,130|107,128|105,126|105,125|102,122|102,121|101,120|101,119|100,118|100,117|98,115|98,113|97,112|97,110|98,109|100,109|100,107|101,106|101,105|103,103|104,103|104,102|105,101|106,101|112,95|113,95|116,92|117,92|119,90|120,90|122,88|123,88|125,86|126,86|127,85|128,85|130,83|131,83|133,81|134,81|135,80|136,80|137,79|138,79|139,78|140,78|141,77|142,77|143,76|144,76|145,75|146,75|147,74|149,74|150,73|151,73|152,72|153,72|154,71|156,71|157,70|158,70|159,69|161,69|162,68|163,68|164,67|165,67|166,66|167,66|168,65|169,65|170,64|171,64|172,63|173,63|174,62|176,62|178,60|179,60|180,59|181,59|182,58|183,58|184,57|185,57|186,56|187,56|188,55|189,55|191,53|192,53|194,51|195,51|196,50|197,50|199,48|200,48|201,47|202,47|202,45|201,45|200,44|200,43|198,41|197,41|192,36|191,36|189,34|189,33|188,32|39,27|39,29|38,30|38,34|37,35|37,38|36,39|36,41|34,43|34,44|33,45|33,46|31,48|31,49|29,51|29,52|28,53|28,54|27,55|27,56|25,58|25,59|22,62|22,63|20,65|20,66|18,68|18,69|17,70|17,71|16,72|16,73|15,74|15,75|13,77|13,79|12,80|12,82|11,83|11,85|10,86|10,87|9,88|9,90|7,92|7,93|6,94|6,95|5,96|5,98|4,99|4,102|3,103|3,108|2,109|2,113|1,114|1,152|2,153|2,157|3,158|3,160|4,161|4,164|5,165|5,166|6,167|6,168|7,169|7,170|8,171|8,173|9,174|9,176|10,177|10,178|11,179|11,181|12,182|12,183|13,184|13,186|14,187|14,188|15,189|15,191|16,192|16,193|17,194|17,195|19,197|19,199|20,200|20,201|22,203|22,204|23,205|23,206|24,207|24,208|25,209|25,210|28,213|28,214|29,215|30,215|33,218|34,218|35,219|36,219|37,220|38,220|39,221|39,223|40,224|40,225|41,225|53,237|53,239|54,239|58,243|59,243|65,249|65,250|68,253|69,253|74,258|75,258|77,260|78,260|79,261|80,261|83,264|84,264|85,265|86,265|88,267|89,267|90,268|91,268|92,269|93,269|94,270|95,270|96,271|97,271|98,272|101,272|103,274|106,274|107,275|108,275|109,276|111,276|112,277|114,277|115,278|121,278|122,279|130,279|131,280|132,280|133,279|142,279|143,278|151,278|152,277|156,277|157,276|159,276|160,275|162,275|163,274|166,274|167,273|169,273|170,272|172,272|173,271|174,271|175,270|176,270|177,269|179,269|180,268|182,268|183,267|185,267|186,266|188,266|189,265|191,265|193,263|194,263|195,262|197,262|199,260|200,260|201,259|202,259|203,258|204,258|205,257|206,257|207,256|208,256|209,255|210,255|211,254|212,254|214,252|215,252|217,250|218,250|221,247|222,247|224,245|225,245|231,239|232,239|236,235|237,235|239,233|240,233|243,230|244,230|251,223|251,222|254,219|257,219|257,214|272,199|272,198|275,195|276,195|277,194|277,193|274,193|272,195|271,194|271,193|269,193|268,194|267,194|266,195|265,195|263,197|262,197|260,199|259,199|258,200|254,200|252,202|251,202|250,203|249,203|248,204|247,204|246,205|244,205|243,206|242,206|241,207|240,207|239,208|237,208|236,209|232,209|231,210|229,210|228,209|228,208|227,208|226,209|224,209|223,210|219,210|218,211|216,211|215,212|212,212|211,213|208,213|207,214|206,213|185,213|184,212|183,212|182,211|181,212|179,212|178,213|180,213|181,214|184,214|185,215|184,216|178,216|178,217|189,217|190,216|193,216|194,215|195,215|196,216|199,216|200,215|201,216|202,216|203,215|212,215|213,214|215,214|216,215|215,216|214,216|213,217|211,217|210,218|206,218|205,219|200,219|199,220|195,220|194,221|184,221|183,220|180,220|179,221|174,221|173,220|172,220|170,218|170,219|171,220|170,221|169,221|168,220|166,220|164,218|163,218|159,214|159,212|160,211|160,210|159,209|159,210|158,211|157,211|156,210|156,208|155,207|155,204|156,203|156,199|159,196|159,195|157,195|156,194|156,193|157,192|157,187|158,186|158,184|160,182|160,179|161,178|161,177|162,176|163,176|165,174|167,174|167,173|171,169|172,169|176,165|177,165|179,163|180,163|186,157|187,157|192,152|193,152|196,149|197,149|199,147|200,147|206,141|207,141|218,130|219,130|226,123|227,123|229,121|229,120|230,119|231,119|237,113|237,112|243,106|244,106|253,97|254,97|261,90|262,90|266,86|266,85|270,81|273,81|274,80|274,79|273,78|273,77|271,75|271,74|268,71|268,70|264,66|264,65|262,63|262,62|261,61|259,61|259,64|260,65|260,66|265,71|265,72|270,77|270,78|253,95|252,95|246,101|245,101|234,112|234,113|233,114|232,114|228,118|228,119|226,121|225,121|218,128|217,128|205,140|204,140|198,146|197,146|195,148|194,148|189,153|188,153|183,158|182,158|177,163|176,163|173,166|172,166|168,170|167,170|164,173|163,173|158,178|158,179|156,181|156,182|154,184|154,185|153,186|154,186|155,185|156,186|156,189|155,190|155,194|154,195|154,198|151,201|151,204|152,205|153,205|154,206|154,208|155,209|155,211|156,212|156,213|161,218|162,218|164,220|165,220|166,221|168,221|169,222|173,222|174,223|184,223|185,222|189,222|190,223|189,224|187,224|186,225|184,225|183,226|181,226|185,226|186,225|188,225|189,224|191,224|192,223|194,223|195,222|201,222|202,221|206,221|207,220|211,220|212,219|214,219|215,218|217,218|218,217|220,217|221,216|223,216|224,215|227,215|228,214|231,214|232,213|234,213|235,212|237,212|238,211|239,211|240,210|242,210|245,207|247,207|248,206|249,206|250,205|251,205|252,204|254,204|256,202|257,202|258,201|260,201|261,200|263,200|264,199|266,199|267,200|267,201|256,212|255,212|254,213|253,213|253,214|252,215|252,216|251,217|251,218|250,219|250,220|243,227|242,227|239,230|238,230|235,233|234,233|231,236|230,236|225,241|224,241|221,244|220,244|217,247|216,247|214,249|213,249|212,250|211,250|209,252|208,252|207,253|206,253|205,254|204,254|203,255|202,255|201,256|200,256|199,257|198,257|197,258|196,258|195,259|194,259|193,260|192,260|190,262|188,262|187,263|186,263|185,264|183,264|182,265|181,265|180,266|178,266|177,267|175,267|174,268|172,268|171,269|170,269|169,270|167,270|166,271|164,271|163,272|161,272|160,273|158,273|157,274|154,274|153,275|149,275|148,276|138,276|137,277|124,277|123,276|118,276|117,275|113,275|111,273|108,273|107,272|105,272|104,271|102,271|101,270|100,270|99,269|97,269|96,268|95,268|94,267|93,267|92,266|91,266|90,265|89,265|87,263|86,263|85,262|84,262|82,260|81,260|78,257|77,257|75,255|74,255|71,252|70,252|69,251|69,250|68,250|66,248|66,247|64,245|63,245|62,244|62,243|61,243|60,242|60,241|59,240|58,240|55,237|55,236|54,236|50,232|50,231|49,230|48,230|47,229|47,228|46,227|45,227|42,224|42,222|41,222|40,221|40,220|41,219|43,219|41,219|40,218|39,218|38,217|36,217|30,211|30,210|28,208|28,207|26,205|26,204|25,203|25,201|24,200|24,199|23,198|23,197|22,196|22,195|21,194|21,193|20,192|20,191|18,189|18,188|17,187|17,186|16,185|16,183|15,182|15,181|14,180|14,178|13,177|13,175|12,174|12,173|11,172|11,170|10,169|10,167|9,166|9,165|8,164|8,162|7,161|7,159|6,158|6,155|5,154|5,150|4,149|4,145|3,144|3,120|4,119|4,115|5,114|5,110|6,109|6,106|7,105|7,101|8,100|8,98|9,97|9,96|10,95|10,93|11,92|11,91|12,90|12,88|13,87|13,85|14,84|14,82|15,81|15,80|16,79|16,78|17,77|17,76|18,75|18,74|19,73|19,72|20,71|20,70|22,68|22,67|24,65|24,64|27,61|27,60|29,58|29,57|30,56|30,55|31,54|31,53|32 ,52|32,51|34,49|34,48|36,46|36,45|37,44|37,43|38,42|38,38|39,37|39,35|40,34|40,31|41,30|41,27";

    void Start()
    {
        GenerateMesh(ArrayFromServer);
    }
    public void GenerateMesh(string arrayServer)
    {
        // Create Vector2 vertices
        /*Vector2[] vertices2D = new Vector2[] {
            new Vector2(0,0),
            new Vector2(0,50),
            new Vector2(50,50),
            new Vector2(50,100),
            new Vector2(0,100),
            new Vector2(0,150),
            new Vector2(150,150),
            new Vector2(150,100),
            new Vector2(100,100),
            new Vector2(100,50),
            new Vector2(150,50),
            new Vector2(150,0),
        };*/

        String[] collection = arrayServer.Split('|');
        //Debug.Log(collection.ToString());
        Vector2[] arrayServerVert = new Vector2[collection.Length];
        for(int i = 0; i < collection.Length;  i++)
        {
            String[] vector2 = collection[i].Split(',');
            //Debug.Log(vector2.Length);
            /*for (int j = 0; j < vector2.Length; j++)
                Debug.Log(vector2[j]);*/
            Vector2 newVector2 = new Vector2(Convert.ToInt16(vector2[0].Replace(" ", "")), Convert.ToInt16(vector2[1].Replace(" ", "")));
            //Debug.Log(newVector2.ToString());
            arrayServerVert[i] = newVector2;
        }
        //Debug.Log(arrayServerVert.ToString());
        // Use the triangulator to get indices for creating triangles
        Triangulator tr = new Triangulator(arrayServerVert);

        int[] indices = tr.Triangulate();

        // Create the Vector3 vertices
        Vector3[] vertices = new Vector3[arrayServerVert.Length];
        for (int i = 0; i < vertices.Length; i++)
        {
            vertices[i] = new Vector3(arrayServerVert[i].x, arrayServerVert[i].y, 0);
        }

        // Create the mesh
        Mesh msh = new Mesh();
        msh.vertices = vertices;
        msh.triangles = indices;
        msh.RecalculateNormals();
        msh.RecalculateBounds();

        // Set up game object with mesh;
        gameObject.AddComponent(typeof(MeshRenderer));
        MeshFilter filter = gameObject.AddComponent(typeof(MeshFilter)) as MeshFilter;
        filter.mesh = msh;
        gameObject.GetComponent<MeshRenderer>().material = testMat;
        gameObject.transform.position = new Vector3(0, 0, 5);
        gameObject.transform.localScale = new Vector3(.01f, .01f, .01f);
        gameObject.transform.Rotate(new Vector3(0,180, 310));
    }
}